<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zachary Burton</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-color: #000;
            --text-color: #fff;
            --panel-bg: rgba(0, 0, 0, 0.8);
            --panel-border: rgba(255, 255, 255, 0.2);
            --node-panel-bg: rgba(0, 0, 0, 0.9);
            --node-panel-border: rgba(0, 255, 255, 0.3);
            --close-btn-color: #ff0000;
            --gradient-start: #00ffff;
            --gradient-end: #0064ff;
            --hint-opacity: 0.6;
            --content-opacity: 0.9;
            --theme-toggle-bg: rgba(255, 255, 255, 0.1);
            --theme-toggle-border: rgba(255, 255, 255, 0.3);
            --theme-icon: "üåô";
        }
        
        body.light-mode {
            --bg-color: #f0f4f8;
            --text-color: #1a202c;
            --panel-bg: rgba(255, 255, 255, 0.95);
            --panel-border: rgba(0, 0, 0, 0.1);
            --node-panel-bg: rgba(255, 255, 255, 0.98);
            --node-panel-border: rgba(0, 100, 255, 0.3);
            --close-btn-color: #e53e3e;
            --gradient-start: #0088cc;
            --gradient-end: #0056b3;
            --hint-opacity: 0.7;
            --content-opacity: 0.85;
            --theme-toggle-bg: rgba(0, 0, 0, 0.1);
            --theme-toggle-border: rgba(0, 0, 0, 0.3);
            --theme-icon: "‚òÄÔ∏è";
        }
        
        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
            position: fixed;
            width: 100%;
            height: 100vh;
            -webkit-overflow-scrolling: touch;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #theme-toggle {
            position: fixed;
            top: 20px;
            left: 340px;
            z-index: 101;
            background: var(--theme-toggle-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--theme-toggle-border);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        #theme-toggle:hover {
            transform: scale(1.1);
            background: var(--theme-toggle-border);
        }
        
        #theme-toggle::after {
            content: var(--theme-icon);
        }
        
        #info {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--panel-border);
            max-width: 300px;
            transition: all 0.3s ease;
        }
        
        #info h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        #info p {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .hint {
            font-size: 11px;
            opacity: var(--hint-opacity);
            margin: 5px 0;
        }
        
        #current-node {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: var(--node-panel-bg);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--node-panel-border);
            max-width: 500px;
            display: none;
            transition: all 0.3s ease;
        }
        
        #current-node.show {
            display: block;
        }
        
        #current-node h2 {
            color: var(--gradient-start);
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        #current-node p {
            line-height: 1.6;
            opacity: var(--content-opacity);
        }
        
        #current-node a {
            transition: opacity 0.3s ease;
        }
        
        #current-node a:hover {
            opacity: 0.8;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: var(--close-btn-color);
            font-size: 20px;
            transition: transform 0.3s ease;
        }
        
        .close-btn:hover {
            transform: rotate(90deg);
        }
        
        .node-label {
            position: absolute;
            color: white;
            font-size: 12px;
            pointer-events: none;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            transform: translate(-50%, -50%);
        }
        
        body.light-mode #current-node h3 {
            filter: brightness(0.7);
        }
        
        body.light-mode #current-node strong {
            color: var(--text-color);
        }

       
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            #info {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 15px;
            }
            
            #info h1 {
                font-size: 20px;
            }
            
            #theme-toggle {
                position: fixed;
                top: auto;
                bottom: 20px;
                right: 20px;
                left: auto;
                z-index: 102;
            }
            
            #current-node {
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                max-width: none;
                max-height: 50vh;
                overflow-y: auto;
                border-radius: 15px 15px 0 0;
            }
            
            #current-node.show {
                animation: slideUp 0.3s ease;
            }
            
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }
            
            .hint {
                display: none; 
            }
            
            #info::after {
                content: "Tap nodes to explore ... Pinch to zoom";
                font-size: 11px;
                opacity: 0.6;
                display: block;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="theme-toggle" onclick="toggleTheme()"></div>
    
    <div id="info">
        <h1>Zachary Burton</h1>
        <p>The "Egocentric" Universe</p>
        <div class="hint">üñ±Ô∏è Left-click and drag to rotate</div>
        <div class="hint">üìú Scroll to zoom</div>
        <div class="hint">üëÜ Click a sphere to explore</div>
        <div class="hint">‚å®Ô∏è Press R to reset view</div>
    </div>
    
    <div id="current-node">
        <span class="close-btn" onclick="closePanel()">‚úï</span>
        <h2 id="node-title"></h2>
        <div id="node-content"></div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Theme management
        let isLightMode = false;
        
        function toggleTheme() {
            isLightMode = !isLightMode;
            document.body.classList.toggle('light-mode');
            
            // Update Three.js scene colors
            if (isLightMode) {
                scene.fog = new THREE.Fog(0xf0f4f8, 10, 100);
                renderer.setClearColor(0xf0f4f8);
                ambientLight.intensity = 2.0;
                pointLight1.intensity = 0.8;
                pointLight2.intensity = 0.3;
                edgeMaterial.opacity = 0.4;
                particleMaterial.opacity = 0.3;
            } else {
                scene.fog = new THREE.Fog(0x000000, 10, 100);
                renderer.setClearColor(0x000000);
                ambientLight.intensity = 1.5;
                pointLight1.intensity = 1;
                pointLight2.intensity = 0.5;
                edgeMaterial.opacity = 0.8;
                particleMaterial.opacity = 0.6;
            }
            
            // Store preference
            localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
        }
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            isLightMode = true;
            document.body.classList.add('light-mode');
        }
        
        // Three.js setup
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(isLightMode ? 0xf0f4f8 : 0x000000, 10, 100);
        
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(15, 10, 15);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ 
            canvas: document.getElementById('canvas'),
            antialias: true 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setClearColor(isLightMode ? 0xf0f4f8 : 0x000000);
        
        const ambientLight = new THREE.AmbientLight(0x404040, isLightMode ? 2.0 : 1.5);
        scene.add(ambientLight);
        
        const pointLight1 = new THREE.PointLight(0xffffff, isLightMode ? 0.8 : 1);
        pointLight1.position.set(10, 10, 10);
        scene.add(pointLight1);
        
        const pointLight2 = new THREE.PointLight(0x00ffff, isLightMode ? 0.3 : 0.5);
        pointLight2.position.set(-10, -10, -10);
        scene.add(pointLight2);
        
        const nodes = [
            { id: 'home', label: 'Zachary Burton', pos: [0, 0, 0], color: 0x00ffff, size: 1, 
              content: 'I\'m a math major at MIT passionate about building infrastructure to advance AI research which in turn can advance human knowledge.' },
            
            { id: 'about', label: 'About', pos: [5, 2, 0], color: 0x0064ff, size: 0.7,
              content: 'Born in NYC, raised in the UK. Ran track for 10 years (10.63s 100m PB).' },
            
            { id: 'research', label: 'Research', pos: [-5, 2, 3], color: 0xff00ff, size: 0.7,
              content: 'A variety!' },
            
            { id: 'projects', label: 'Projects', pos: [3, -3, -5], color: 0x00ff64, size: 0.7,
              content: `
                <div>
                  <p><strong>Technical Projects:</strong></p>
                  <p style="margin-top: 15px;">Building tools at the intersection of AI, education, and productivity.</p>
                  <p style="margin-top: 15px; opacity: 0.7;">Click connected nodes to explore each project.</p>
                </div>
              `},
            
           { id: 'speaking', label: 'Public Speaking', pos: [-4, -2, -3], color: 0xff6400, size: 0.7,
              content: `
                <p>Speeches I gave as a high-schooler / secondary school student..</p>
                <p style="margin-top: 15px; opacity: 0.7;">Click the connected nodes to watch!</p>
              `},

            { id: 'black-tonbridge', label: 'Being Black at Tonbridge', pos: [-5, -3, -4], color: 0xff6400, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 15px;">Yeah...</p>
                  <div class="video-container">
                  <iframe
                    width="100%"
                    height="215"
                    src="https://www.youtube.com/embed/olbr9p6eVsw"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    style="border-radius: 10px;">
                  </iframe>
                  </div>
                  <a href="https://www.youtube.com/watch?v=olbr9p6eVsw" 
                     target="_blank" 
                     style="display: inline-block; margin-top: 10px; color: #ff6400; text-decoration: none;">
                    Watch on YouTube
                  </a>
                </div>
              `},
            
            { id: 'n-word', label: 'Why White People Shouldn\'t Use the N-Word', pos: [-6, -1, -2], color: 0xff6400, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 15px;"Self explantatory?".</p>
                  <div class="video-container">
                  <iframe
                    width="100%"
                    height="215"
                    src="https://www.youtube.com/embed/q132uRqVpqA"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    style="border-radius: 10px;">
                  </iframe>
                  </div>
                  <a href="https://www.youtube.com/watch?v=q132uRqVpqA" 
                     target="_blank" 
                     style="display: inline-block; margin-top: 10px; color: #ff6400; text-decoration: none;">
                    Watch on YouTube
                  </a>
                </div>
              `},
            
            { id: 'gauss', label: 'Magnetic Gauss Law', pos: [-3, -4, -5], color: 0xff6400, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 15px;">Gauss' law means we can't have magnetic monopoles :(.</p>
                  <div class="video-container">
                  <iframe
                    width="100%"
                    height="215"
                    src="https://www.youtube.com/embed/gsVf2ywt7VQ"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    style="border-radius: 10px;">
                  </iframe>
                  </div>
                  <a href="https://www.youtube.com/watch?v=gsVf2ywt7VQ" 
                     target="_blank" 
                     style="display: inline-block; margin-top: 10px; color: #ff6400; text-decoration: none;">
                    Watch on YouTube
                  </a>
                </div>
              `},
            
            { id: 'meta', label: 'Meta', pos: [7, 4, 1], color: 0x0064ff, size: 0.5,
              content: 'Software Engineer Intern (May-Aug 2025) - Rebuilt entire copyright enforcement logic, 97% consistency with prod, fixed a 16% FP rate in internal tooling.' },
            
            { id: 'mit-node', label: 'MIT', pos: [6, 3, -2], color: 0x0064ff, size: 0.5,
              content: 'SB Degree in Mathematics (2022-present).' },
            
            { id: 'pieface', label: 'PIEFACE', pos: [4, -4, -6], color: 0x00ff64, size: 0.5,
              content: `
                <div>
                  <h3 style="color: #00ff64; margin-bottom: 10px;">PIEFACE</h3>
                  <p style="margin-bottom: 15px;"><strong>World's first research sandbox for theoretical CS</strong></p>
                  <p style="margin-bottom: 20px;">Builds off the work done in RL for hardness proofs, originally designed as a debugger/visualiser. Working on serving an online RLHF component for true human+AI research.</p>
                  <a href="https://pieface.ai" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #00ff64, #00cc52); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;
                            margin-bottom: 10px;">
                    Use PIEFACE...
                  </a>
                </div>
              `},
            
            { id: 'rl-proofs', label: 'RL for Hardness Proofs', pos: [-7, 3, 4], color: 0xff00ff, size: 0.5,
                  content: `
                    <div>
                      <p style="margin-bottom: 15px;">Research under Jayson Lynch at MIT CSAIL (FutureTech)</p>
                      <p style="margin-bottom: 20px;">Developing RL approaches for automated complexity-theoretic gadget reductions and proof generation in NL/PSPACE.</p>
                      <a href="https://openreview.net/forum?id=50w4SZTl2V&noteId=50w4SZTl2V" 
                         target="_blank" 
                         style="background: linear-gradient(135deg, #ff00ff, #ff66ff); 
                                color: white; 
                                padding: 10px 20px; 
                                border-radius: 20px; 
                                text-decoration: none; 
                                display: inline-block; 
                                font-weight: bold;
                                margin-bottom: 10px;">
                        View on OpenReview!
                      </a>
                    </div>
                  `},

            { id: 'algotrackr', label: 'AlgoTrackr', pos: [5, -2, -4], color: 0x00ff64, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 15px;"><strong>Personal LeetCode Performance Tracker</strong></p>
                  <p style="margin-bottom: 20px;">Comprehensive analytics platform for tracking algorithmic problem-solving progress. Are you on the early access list?</p>
                  <a href="https://algotrackr.com" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #00ff64, #00cc52); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;
                            margin-bottom: 10px;">
                    Get cracked at LC.
                  </a>
                </div>
              `},

            { id: 'scribe', label: 'Scribe AI', pos: [2, -5, -7], color: 0x00ff64, size: 0.5,
              content: `
                <div>
                  <h3 style="color: #00ff64; margin-bottom: 10px;">Scribe AI</h3>
                  <p style="margin-bottom: 15px;"><strong>Autocomplete for Mathematical Handwriting</strong></p>
                  <p style="margin-bottom: 20px;"> We built this before big tech co-opted this fyi</p>
                  <a href="https://devpost.com/software/scribe-slo6iw" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #00ff64, #00cc52); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;
                            margin-bottom: 10px;">
                    View on Devpost.  
                  </a>
                </div>
              `},

            { id: 'resume', label: 'Resume', pos: [-2, 4, -4], color: 0xffff00, size: 0.6,
            content: 'View my full resume with experience, skills, and education.<br><br><a href="https://drive.google.com/file/d/1D8sEorVlThrUKL9pTFDEiao82Ct44ie9" target="_blank" style="background: #00ffff; color: #000; padding: 10px 20px; border-radius: 20px; text-decoration: none; display: inline-block; font-weight: bold;">View Resume</a>' },

            { id: 'linkedin', label: 'LinkedIn', pos: [8, 2, -1], color: 0x0077b5, size: 0.4,
              content: `
                <div style="text-align: center;">
                  <p style="margin-bottom: 15px;">My professional network and updates</p>
                  <a href="https://linkedin.com/in/zacburton" 
                     target="_blank" 
                     style="background: #0077b5; 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    Connect on LinkedIn!
                  </a>
                </div>
              `},
            
            { id: 'github', label: 'GitHub', pos: [7, 1, 2], color: 0x1a1f3a, size: 0.4,
              content: `
                <div style="text-align: center;">
                  <p style="margin-bottom: 15px;">Code repositories and open source</p>
                  <a href="https://github.com/zacn04" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #1a1f3a, #0064ff); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    View GitHub Profile!
                  </a>
                </div>
              `},
            { id: 'collision', label: 'Math preprint', pos: [-6, 4, 2], color: 0xff00ff, size: 0.5,
              content: `
                <div>
                  <h3 style="color: #ff00ff; margin-bottom: 10px;">Poissonization-based collision threshold derivation for random walks on lattices</h3>
                  <p style="margin-bottom: 20px;">Using Poissonization and generating function asymptotics to re-derive sharp thresholds for pairwise collisions via the Laplace method. Disclaimer: it's an expository note! </p>
                  <a href="https://arxiv.org/abs/2505.02973" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #ff00ff, #ff66ff); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    View Preprint on arXiv
                  </a>
                </div>
              `},
            { id: 'llm-social', label: 'Persuasiveness of LLMs in Social Media', pos: [-8, 1, 3], color: 0xff00ff, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 20px;">Investigation into how large language models can shape political discourse and persuasion in social media contexts.</p>
                  <a href="https://drive.google.com/file/d/1A0UiC6z3Udbn-D7P9Vp2BhTOHjAHcRvA/view?usp=share_link" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #ff00ff, #ff66ff); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    Read Paper
                  </a>
                </div>
              `},

            { id: 'singapore-research', label: 'SIPGA Scholar Research (2023)', pos: [-5, 0, 5], color: 0xff00ff, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 20px;">Reinforcement learning research conducted as a SIPGA scholarship recipient.</p>
                  <a href="https://drive.google.com/drive/folders/1T71rAHhji8ok6YP1fN3_MQgVUo2PyiNS" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #ff00ff, #ff66ff); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    View Research Materials
                  </a>
                </div>
              `},
            { id: 'astrophysics', label: 'Astrophysics', pos: [-5, 2, 5], color: 0xff00ff, size: 0.5,
              content: `
                <div>
                  <p style="margin-bottom: 15px;">MIT EAPS - December 2022</p>
                  <p style="margin-bottom: 20px;">Working under Jordan Steckloff and Jason Soderblom on sensitivity studies of comet outbursts. Computational modeling of stellar dynamics and planetary formation processes.</p>
                </div>
              `},
            { id: 'blog', label: 'Blog', pos: [7, 3, -4], color: 0xe3242b, size:0.5,
             content: `
             <div style="text-align: center;">
                  <a href="/blog_base.html" 
                     target="_blank" 
                     style="background: linear-gradient(135deg, #000000, #ff0000); 
                            color: white; 
                            padding: 10px 20px; 
                            border-radius: 20px; 
                            text-decoration: none; 
                            display: inline-block; 
                            font-weight: bold;">
                    Read my ramblings...
                  </a>
                </div>
            `},
        ];
        
        const edges = [
            ['home', 'about'],
            ['home', 'research'],
            ['home', 'projects'],
            ['home', 'speaking'],
            ['home', 'resume'],
            ['about', 'meta'],
            ['about', 'mit-node'],
            ['about', 'linkedin'],
            ['about', 'github'],
            ['about', 'blog'],
            ['projects', 'pieface'],
            ['projects', 'algotrackr'],
            ['projects', 'scribe'],
            ['research', 'rl-proofs'],
            ['research', 'collision'],
            ['research', 'llm-social'],
            ['research', 'singapore-research'],
            ['research', 'astrophysics'],
            ['speaking', 'black-tonbridge'],
            ['speaking', 'n-word'],
            ['speaking', 'gauss'],
        ];
        
        const nodeMaterials = {};
        nodes.forEach(node => {
            nodeMaterials[node.id] = new THREE.MeshPhongMaterial({
                color: node.color,
                emissive: node.color,
                emissiveIntensity: 0.3,
                shininess: 100
            });
        });
        
        const nodeMeshes = {};
        nodes.forEach(node => {
            const segments = isMobile ? 16 : 32;
            const geometry = new THREE.SphereGeometry(node.size, segments, segments);
            const mesh = new THREE.Mesh(geometry, nodeMaterials[node.id]);
            mesh.position.set(...node.pos);
            mesh.userData = { id: node.id, label: node.label, content: node.content };
            scene.add(mesh);
            nodeMeshes[node.id] = mesh;
        });
        
        // Create edges
        const edgeGeometry = new THREE.BufferGeometry();
        const positions = [];
        edges.forEach(([source, target]) => {
            const sourceNode = nodeMeshes[source];
            const targetNode = nodeMeshes[target];
            if (sourceNode && targetNode) {
                positions.push(...sourceNode.position.toArray());
                positions.push(...targetNode.position.toArray());
            }
        });
        edgeGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        
        const edgeMaterial = new THREE.LineBasicMaterial({ 
            color: 0x00ffff,
            transparent: true,
            opacity: isLightMode ? 0.4 : 0.8,
            linewidth: 2
        });
        const edgeLines = new THREE.LineSegments(edgeGeometry, edgeMaterial);
        scene.add(edgeLines);
        
        const particleGeometry = new THREE.BufferGeometry();
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const particleCount = isMobile ? 100 : 500; // Reduce particles on mobile
        const particlePositions = new Float32Array(particleCount * 3);
        for (let i = 0; i < particleCount * 3; i++) {
            particlePositions[i] = (Math.random() - 0.5) * 50;
        }
        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        
        const particleMaterial = new THREE.PointsMaterial({
            color: 0x0088ff,
            size: 0.1,
            transparent: true,
            opacity: isLightMode ? 0.3 : 0.6
        });
        const particles = new THREE.Points(particleGeometry, particleMaterial);
        scene.add(particles);
        
        let mouseX = 0, mouseY = 0;
        let targetX = 0, targetY = 0;
        let isDragging = false;
        let previousMouseX = 0, previousMouseY = 0;
        let rotationX = 0, rotationY = 0;
        let zoom = 20;
        
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            if (isDragging) {
                const deltaX = event.clientX - previousMouseX;
                const deltaY = event.clientY - previousMouseY;
                rotationY += deltaX * 0.01;
                rotationX += deltaY * 0.01;
                previousMouseX = event.clientX;
                previousMouseY = event.clientY;
            }
        }
        
        function onMouseDown(event) {
            isDragging = true;
            previousMouseX = event.clientX;
            previousMouseY = event.clientY;
        }
        
        function onMouseUp() {
            isDragging = false;
        }
        
        function onMouseClick(event) {
            if (event.target.id !== 'canvas') return;
            
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(Object.values(nodeMeshes));
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                const nodeData = clickedObject.userData;
                showNodeInfo(nodeData);
                
                clickedObject.scale.set(1.5, 1.5, 1.5);
                setTimeout(() => {
                    clickedObject.scale.set(1, 1, 1);
                }, 300);
            }
        }
        
        function onWheel(event) {
            zoom += event.deltaY * 0.01;
            zoom = Math.max(5, Math.min(30, zoom));
        }
        
        function showNodeInfo(nodeData) {
            const panel = document.getElementById('current-node');
            const title = document.getElementById('node-title');
            const content = document.getElementById('node-content');
            
            title.textContent = nodeData.label;
            content.innerHTML = `<p>${nodeData.content}</p>`;
            panel.classList.add('show');
        }
        
        function closePanel() {
            document.getElementById('current-node').classList.remove('show');
        }
        
        function onKeyDown(event) {
            if (event.key === 'r' || event.key === 'R') {
                rotationX = 0;
                rotationY = 0;
                zoom = 20;
                closePanel();
            }
        }
        
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mousedown', onMouseDown);
        document.addEventListener('mouseup', onMouseUp);
        document.addEventListener('click', onMouseClick);
        document.addEventListener('wheel', onWheel);
        document.addEventListener('keydown', onKeyDown);

        let touchStartX = 0, touchStartY = 0;
        let lastTouchDistance = 0;
        
        function onTouchStart(event) {
            event.preventDefault();
            if (event.touches.length === 1) {
                isDragging = true;
                touchStartX = event.touches[0].clientX;
                touchStartY = event.touches[0].clientY;
                previousMouseX = touchStartX;
                previousMouseY = touchStartY;
            } else if (event.touches.length === 2) {
                // For pinch zoom
                const dx = event.touches[0].clientX - event.touches[1].clientX;
                const dy = event.touches[0].clientY - event.touches[1].clientY;
                lastTouchDistance = Math.sqrt(dx * dx + dy * dy);
            }
        }
        
        function onTouchMove(event) {
            event.preventDefault();
            if (event.touches.length === 1 && isDragging) {
                const deltaX = event.touches[0].clientX - previousMouseX;
                const deltaY = event.touches[0].clientY - previousMouseY;
                rotationY += deltaX * 0.01;
                rotationX += deltaY * 0.01;
                previousMouseX = event.touches[0].clientX;
                previousMouseY = event.touches[0].clientY;
            } else if (event.touches.length === 2) {
                // Pinch zoom
                const dx = event.touches[0].clientX - event.touches[1].clientX;
                const dy = event.touches[0].clientY - event.touches[1].clientY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const delta = distance - lastTouchDistance;
                zoom -= delta * 0.05;
                zoom = Math.max(5, Math.min(30, zoom));
                lastTouchDistance = distance;
            }
        }
        
        function onTouchEnd(event) {
            isDragging = false;
        }

        function onTouchTap(event) {
            if (event.touches.length === 1) {
                const touch = event.touches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(Object.values(nodeMeshes));
                
                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    const nodeData = clickedObject.userData;
                    showNodeInfo(nodeData);
                    
                    // Visual feedback
                    clickedObject.scale.set(1.5, 1.5, 1.5);
                    setTimeout(() => {
                        clickedObject.scale.set(1, 1, 1);
                    }, 300);
                }
            }
        }
        
        document.addEventListener('touchstart', onTouchStart, { passive: false });
        document.addEventListener('touchmove', onTouchMove, { passive: false });
        document.addEventListener('touchend', onTouchEnd);
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length === 1) {
                setTimeout(() => {
                    if (!isDragging) {
                        onTouchTap(event);
                    }
                }, 200); 
            }
        });
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize);
        
        function animate() {
            requestAnimationFrame(animate);
            
            camera.position.x = Math.sin(rotationY) * Math.cos(rotationX) * zoom;
            camera.position.y = Math.sin(rotationX) * zoom;
            camera.position.z = Math.cos(rotationY) * Math.cos(rotationX) * zoom;
            camera.lookAt(0, 0, 0);
            
            particles.rotation.y += 0.0005;
            const mainNode = nodeMeshes['home'];
            if (mainNode) {
                const scale = 1 + Math.sin(Date.now() * 0.001) * 0.1;
                mainNode.scale.set(scale, scale, scale);
            }
            
            Object.values(nodeMeshes).forEach(mesh => {
                if (mesh.userData.id !== 'home') {
                    mesh.rotation.y += 0.01;
                }
            });
            
            renderer.render(scene, camera);
        }
        
        animate();
        
    </script>
</body>
</html>
